\name{BF_WGCNA}
\alias{BF_WGCNA}
\title{ Identify differential co-expression modules}
\description{
 Apply WGCNA [1] to identify differential co-expression modules through pair-wise Bayes factors.
}
\usage{
BF_WGCNA(
         dataExp,
         bfmatrix,
         bfthr=6,
         keepedges=dim(dataExp)[2],
         softPower=(ifelse(keepedges != 0, 1,6)),
         plotTree=TRUE,
         plotfile="Gene_dendrogram_and_module_colors.pdf",
         trueModule=NULL;
         ...)
}
\arguments{

  \item{dataExp}{ a data frame or matrix containing expression data. Columns correspond to genes and rows to samples. Must be kept the same throughout the analyses.}

  \item{bfmatrix}{  a \code{bfmatrix} object containing information of pair-wise Bayes factors generated by \code{\link{Compute_bf}}. Refer to \link{Compute_bf} for details.}
  
  \item{bfthr}{ Bayes factor threshold. The default value is 6 }
  
  \item{keepedges}{ a numerical variable indicating how many top edges to be remained in terms of Bayes factor. \code{keepedges} is invalid when is set as 0. When \code{keepedges} is not 0, it is prior to \code{bfthr}. The default value is the number of genes in \code{dataExp}. }  

  \item{softPower}{ soft thresholding power. Such as the argument \code{power} in package WGCNA. The default value is 1 when \code{keepedges} is not 0, otherwise is 6.}

  \item{plotTree}{ if \code{TRUE}, plots a hierarchical clustering dendrogram and color annotation(s) of module(s) in file specified by argument \code{plotfile}. }

  \item{plotfile}{ if \code{plotTree} is \code{TRUE}, specify a file (in pdf format) to output the dendrogram plot. The default file name is "Gene_dendrogram_and_module_colors.pdf".}

  \item{trueModule}{a vector of color names in the order of genes in \code{dataExp}. If not \code{NULL}, it represents the true module assignment for each gene, can be used as a comparison. }

  \item{...}{ Arguments to be passed to method \code{\link{cutreeDynamic}} in package dynamicTreecut. see \url{"https://CRAN.R-project.org/package=dynamicTreeCut"}
  Arguments, like minClusterSize, cutHeight, deepSplit and method are very crucial for the clustering result.}
              \enumerate{
              \item minClusterSize: minimum cluster size. The default value is 20.
              \item cutHeight: the maximum joining heights that will be considered. see see \url{"https://CRAN.R-project.org/package=dynamicTreeCut"}. The default value is NULL.
              \item deepSplit:  provides a rough control over sensitivity to cluster splitting. see \url{"https://CRAN.R-project.org/package=dynamicTreeCut"}
              \item method: chooses the method to use. Recognized values are "hybrid" and "tree".
  }
}
\details{

  We apply WGCNA [1], an approach for co-expression analysis, to identify differential co-expression modules. It transfers pair-wise Bayes factor matrix into adjacency matrix first, then transfer this adjacency matrix into topological overlap matrix by TOMdist function from package WGCNA, then do hierarchical clustering using cutreeDynamic function from package dynamicTreeCut [2]. The arguments \code{bfthr} and \code{keepedges} are considered as hard thresholding. When the hard thresholding is set, the argument \code{softPower} for soft thresholding is usually set as 1 and only gene pairs which satisfy the bfthr thresholding or keepedges thresholding are considered in the clustering procedure. 

}
\value{
 A \code{BFobt} object. 
 It's a list consist of one data frame component indicating module assignment ($modules),
 one matrix component indicating adjacency matrix ($adjacencies),
 one matrix component indicating Bayes factor matrix ($bf),
 one matrix component indicating which model is selected for gene1 and gene2 ($type),
 and one component indicating a hierarchical clustering dendrogram as produced by 'hclust' ($geneTree).
}
\references{ 
 {[1] Langfelder P, Horvath S. WGCNA: an R package for weighted correlation network analysis. BMC bioinformatics. 2008;9:1.}
 {[2] Langfelder P, Zhang B, Horvath S. Defining clusters from a hierarchical cluster tree: the Dynamic Tree Cut package for R. Bioinformatics. 2008;24:719-20.}
}
\keyword{ package }

